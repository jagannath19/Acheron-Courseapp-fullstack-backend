/**
 * 
 */
package com.acheron.courseapp.repository;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Set;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.PropertySource;
import org.springframework.core.env.Environment;
import org.springframework.stereotype.Repository;

import com.acheron.courseapp.model.Course;
import com.algolia.search.DefaultSearchClient;
import com.algolia.search.SearchClient;
import com.algolia.search.SearchIndex;
import com.algolia.search.models.indexing.BrowseIndexQuery;
import com.algolia.search.models.indexing.BrowseIndexResponse;
import com.algolia.search.models.indexing.Query;
import com.algolia.search.models.indexing.SearchResult;
import com.algolia.search.models.settings.IndexSettings;
import com.algolia.search.models.settings.SetSettingsResponse;

/**
 * @author JagannathSutar
 *	This repository class use to do operation with ALGOLIA database 
 */
@Repository
//@PropertySource( value = "application.properties")
public class CourseRepository implements ICourseRepository {
//	@Autowired
//	Environment environment;
	
//	@Value("${api.application.id}")
//	private String applicationId;
//	
//	@Value("${api.admin.key}")
//	private String adminKey;
//	SearchClient client=DefaultSearchClient.create(applicationId,adminKey);
	SearchClient client=DefaultSearchClient.create("BWN0VYKP4E","0c805a3cf34b135916f08df31e635715");
	SearchIndex<Course> index = client.initIndex("course_index", Course.class);
	
	@Override
	public void addCourse(Course course) {
		index.saveObject(course).waitTask();
		
	}
	@Override
	public void updateCourse(Course course) {
		index.saveObject(course).waitTask();
	}
	@Override
	public void deleteCourse(String courseId) {
		index.deleteObject(courseId);
	}
	@Override
	public Course getById(String courseId) {
		return index.getObject(courseId);
	}
	@Override
	public List<Course> getAll() {
		List<Course> courses=new ArrayList<>();
		
		for (Course course: index.browseObjects(new BrowseIndexQuery())) {
		    courses.add(course);
		}
		
		return courses;
	}
	@Override
	public BrowseIndexResponse<Course> getAllWithPagination(int pages,int hitsPerPage) {
//		SetSettingsResponse pagingIndex= index.setSettings(
//				  new IndexSettings().setHitsPerPage(10)
//				); 
		
//		return index.search(
//				  new Query("query").setPage(hitsPerPage).getAttributesToRetrieve()
//				);
		
		  BrowseIndexResponse<Course> courses = index
                .browseFrom(new BrowseIndexQuery().setPage(pages).setHitsPerPage(hitsPerPage));
		  return courses;
	}
	@Override
	public BrowseIndexResponse<Course> getAllSorting(String attribute) {
		
//		return index.setSettings(
//				  new IndexSettings().setReplicas(Collections.singleton(attribute)));
		
//		SetSettingsResponse replicaIndex=index.setSettings(
//		        new IndexSettings().setReplicas(Collections.singletonList("sorting"))
//		);
		
//		BrowseIndexResponse<Course> courses = index
//                .browseFrom(new BrowseIndexQuery().setSortFacetValuesBy(attribute));
//		
//		return courses;
		return null
		
		
		
	}
	@Override
	public List<Course> getAll(String attribute) {
		 List<Course> courses=new ArrayList<>();
		
		for (Course course: index.browseObjects(new BrowseIndexQuery())) {
		    courses.add(course);
		}
		
		return courses;
	}

	

}
